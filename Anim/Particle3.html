<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mesmerizing Visualization — Enhanced Particles</title>
  <style>
    :root{
      --glass-bg: rgba(255,255,255,0.05);
      --glass-border: rgba(255,255,255,0.08);
      --accent: 255, 160, 60;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:#02030a;overflow:hidden}
    canvas#scene{position:fixed;inset:0;display:block;will-change:transform;}

    body::before{
      content:"";position:fixed;inset:-20% ;
      background: radial-gradient(40% 40% at 10% 20%, rgba(142,68,173,0.12), transparent 12%),
                  radial-gradient(40% 40% at 90% 80%, rgba(52,152,219,0.12), transparent 14%),
                  radial-gradient(35% 35% at 50% 50%, rgba(241,196,15,0.06), transparent 20%);
      pointer-events:none;filter:blur(60px) saturate(140%);
      animation: drift 50s linear infinite;
    }
    @keyframes drift{from{transform:translate(0,0) rotate(0deg)}to{transform:translate(-8%,6%) rotate(360deg)}}

    .ui{position:fixed;right:18px;top:18px;z-index:60;display:flex;flex-direction:column;gap:12px}
    .panel{backdrop-filter: blur(10px) saturate(140%);background:var(--glass-bg);border:1px solid var(--glass-border);padding:14px 16px;border-radius:14px;color:#eef2ff;min-width:240px;box-shadow:0 8px 40px rgba(2,6,23,0.8)}
    .panel h1{font-size:15px;margin:0 0 10px 0;letter-spacing:0.7px;color:#fff}
    .row{display:flex;align-items:center;gap:8px}
    label{font-size:12px;opacity:0.9}
    input[type=range]{width:calc(100% - 60px)}
    .small{font-size:11px;opacity:0.85}
    button, .btn{background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.1);padding:8px 12px;border-radius:12px;color:#fff;font-size:13px;cursor:pointer;transition:all 0.2s ease}
    button:hover{background:rgba(255,255,255,0.12)}
    .row-between{display:flex;justify-content:space-between;align-items:center}

    .hint{position:fixed;left:18px;bottom:18px;z-index:60;color:#dbe6ff;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,0.06);backdrop-filter:blur(8px);font-size:13px;box-shadow:0 4px 20px rgba(0,0,0,0.4)}

    .credits{position:fixed;left:18px;top:18px;color:rgba(255,255,255,0.65);font-size:12px}
    a.link{color:inherit;text-decoration:none;border-bottom:1px dotted rgba(255,255,255,0.12)}

    @media (max-width:720px){
      .panel{min-width:180px;padding:10px}
      .ui{right:12px;top:12px}
      .hint{left:12px;bottom:12px}
    }
  </style>
</head>
<body>
  <canvas id="scene"></canvas>

  <div class="ui">
    <div class="panel" id="controls">
      <h1>✨ Enhanced Particle Universe ✨</h1>
      <div class="row-between">
        <div class="small">Particles: <span id="countLabel">700</span></div>
        <div style="display:flex;gap:8px">
          <button id="toggle" class="btn">Pause</button>
          <button id="randomize" class="btn">Palette</button>
        </div>
      </div>
      <div style="height:8px"></div>
      <div class="row"><label class="small">Count</label><input id="count" type="range" min="100" max="2500" value="700"></div>
      <div class="row"><label class="small">Size</label><input id="size" type="range" min="0.5" max="8" step="0.1" value="2"></div>
      <div class="row"><label class="small">Speed</label><input id="speed" type="range" min="0" max="4" step="0.01" value="1"></div>
      <div class="row"><label class="small">Trail</label><input id="trail" type="range" min="0.88" max="0.997" step="0.001" value="0.93"></div>
      <div class="row"><label class="small">Links</label><input id="links" type="checkbox" checked></div>
      <div style="height:8px"></div>
      <div class="small">Interaction: move mouse — <strong>push</strong>; click &amp; drag — <strong>pull</strong></div>
    </div>
  </div>

  <div class="hint">Move mouse to push nearby particles. Click & drag to attract. Toggle <strong>links</strong> for connecting lines.</div>
  <div class="credits">Made with ❤️ — inspired by nature & light</div>

  <script>
  (function(){
    const canvas = document.getElementById('scene');
    const ctx = canvas.getContext('2d');
    let DPR = Math.max(1, window.devicePixelRatio || 1);

    const elCount = document.getElementById('count');
    const elSize = document.getElementById('size');
    const elSpeed = document.getElementById('speed');
    const elTrail = document.getElementById('trail');
    const elLinks = document.getElementById('links');
    const countLabel = document.getElementById('countLabel');
    const toggleBtn = document.getElementById('toggle');
    const randomizeBtn = document.getElementById('randomize');

    let W=0,H=0;
    function resize(){
      DPR = Math.max(1, window.devicePixelRatio || 1);
      W = Math.floor(window.innerWidth);
      H = Math.floor(window.innerHeight);
      canvas.width = Math.floor(W*DPR);
      canvas.height = Math.floor(H*DPR);
      canvas.style.width = W + 'px';
      canvas.style.height = H + 'px';
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener('resize', resize);
    resize();

    let particles = [];
    let running = true;

    let baseHue = Math.random()*360;
    let hueSpread = 45 + Math.random()*140;
    function randomizePalette(){ baseHue = Math.random()*360; hueSpread = 40 + Math.random()*160; }

    function createParticle(i){
      const x = Math.random()*W;
      const y = Math.random()*H;
      const angle = Math.random()*Math.PI*2;
      const speed = (0.2 + Math.random()*1.8) * +elSpeed.value;
      const size = (0.6 + Math.random()*1.8) * +elSize.value;
      const hue = (baseHue + (Math.random()-0.5)*hueSpread + i*0.02) % 360;
      return {x,y,vx:Math.cos(angle)*speed, vy:Math.sin(angle)*speed, size, hue, life: Math.random()*1000};
    }

    function initParticles(n){
      particles = new Array(n);
      for(let i=0;i<n;i++) particles[i] = createParticle(i);
    }

    const mouse = {x: W/2, y: H/2, px:null, py:null, down:false, moved:false};
    function updatePointer(e){
      const rect = canvas.getBoundingClientRect();
      mouse.x = (e.clientX - rect.left);
      mouse.y = (e.clientY - rect.top);
      mouse.moved = true;
    }
    window.addEventListener('pointermove', (e)=>{updatePointer(e); mouse.px = e.movementX; mouse.py = e.movementY;});
    window.addEventListener('pointerdown', ()=>{mouse.down = true});
    window.addEventListener('pointerup', ()=>{mouse.down = false});
    window.addEventListener('pointerleave', ()=>{mouse.moved=false});

    elCount.addEventListener('input', ()=>{
      const n = Math.round(+elCount.value);
      countLabel.textContent = n;
      const old = particles.length;
      if(n>old){
        for(let i=old;i<n;i++) particles.push(createParticle(i));
      } else if(n<old){
        particles.length = n;
      }
    });
    toggleBtn.addEventListener('click', ()=>{running = !running; toggleBtn.textContent = running? 'Pause':'Play'; if(running) requestAnimationFrame(loop);});
    randomizeBtn.addEventListener('click', ()=>{randomizePalette(); for(let i=0;i<particles.length;i++) particles[i].hue = (baseHue + (Math.random()-0.5)*hueSpread + i*0.02) % 360;});

    initParticles(+elCount.value);

    function clamp(v,a,b){return Math.max(a,Math.min(b,v));}

    let last = performance.now();
    function loop(now){
      if(!running) return;
      const dt = Math.min(40, now - last)*0.001; last = now;

      const trailAlpha = +elTrail.value;
      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = `rgba(4,5,10, ${1 - trailAlpha})`;
      ctx.fillRect(0,0,W,H);

      ctx.globalCompositeOperation = 'lighter';

      const mX = mouse.x, mY = mouse.y;
      const interactionRadius = Math.max(60, Math.min(260, 120 * ( +elSize.value/2)));
      const baseAttraction = 160 * (+elSpeed.value || 1);

      for(let i=0;i<particles.length;i++){
        const p = particles[i];

        const wander = (Math.sin((p.life + now*0.001)*0.5) + Math.cos((p.life*0.7 + now*0.001)*0.3))*0.3;
        p.vx += Math.cos(p.life*0.01 + i) * 0.001 * (+elSpeed.value);
        p.vy += Math.sin(p.life*0.008 - i) * 0.001 * (+elSpeed.value);

        if(mouse.moved){
          const dx = p.x - mX;
          const dy = p.y - mY;
          const d2 = dx*dx + dy*dy;
          const r = interactionRadius;
          if(d2 < r*r){
            const d = Math.sqrt(d2) || 0.0001;
            const normx = dx / d;
            const normy = dy / d;
            const influence = (1 - (d / r));
            const strength = baseAttraction * influence * dt;
            if(mouse.down){
              p.vx -= normx * strength * 0.9;
              p.vy -= normy * strength * 0.9;
            } else {
              p.vx += normx * strength * 1.0;
              p.vy += normy * strength * 1.0;
            }
          }
        }

        p.x += p.vx * dt * 60;
        p.y += p.vy * dt * 60;

        const margin = 20;
        if(p.x < -margin) p.x = W + margin;
        if(p.x > W + margin) p.x = -margin;
        if(p.y < -margin) p.y = H + margin;
        if(p.y > H + margin) p.y = -margin;

        p.vx *= 0.985;
        p.vy *= 0.985;
        const vLim = 6 * (+elSpeed.value || 1);
        p.vx = clamp(p.vx, -vLim, vLim);
        p.vy = clamp(p.vy, -vLim, vLim);

        p.life += dt*60;
        const hue = (p.hue + p.life*0.02) % 360;
        const sat = 78 + Math.sin(p.life*0.03 + i)*12;
        const light = 50 + Math.cos(p.life*0.025 + i)*12;
        const alpha = 0.55 + Math.min(0.65, Math.abs(p.vx)+Math.abs(p.vy))*0.08;

        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.beginPath();
        const s = p.size;
        ctx.fillStyle = `hsla(${hue}, ${sat}%, ${light}%, ${alpha})`;
        ctx.shadowColor = `hsla(${hue}, ${sat}%, ${light}%, ${Math.min(0.9, alpha)})`;
        ctx.shadowBlur = Math.max(8, s*12);
        ctx.arc(0,0, Math.max(0.6, s), 0, Math.PI*2);
        ctx.fill();
        ctx.restore();
      }

      if(elLinks.checked){
        ctx.globalCompositeOperation = 'screen';
        ctx.lineWidth = 0.7;
        for(let i=0;i<particles.length;i++){
          const a = particles[i];
          for(let j=i+1;j<particles.length;j++){
            const b = particles[j];
            const dx = a.x-b.x, dy=a.y-b.y;
            const d2=dx*dx+dy*dy;
            if(d2<160*160){
              const d=Math.sqrt(d2);
              const alpha=0.15*(1-d/160);
              if(alpha>0){
                ctx.strokeStyle=`hsla(${(a.hue+b.hue)/2},70%,60%,${alpha})`;
                ctx.beginPath();
                ctx.moveTo(a.x,a.y);
                ctx.lineTo(b.x,b.y);
                ctx.stroke();
              }
            }
          }
        }
      }

      requestAnimationFrame(loop);
    }

    requestAnimationFrame(loop);

    countLabel.textContent = elCount.value;

    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) running=false; else { running=true; requestAnimationFrame(loop);} });

    window.addEventListener('touchstart',(e)=>{ const t = e.touches[0]; if(t) updatePointer(t); mouse.down = true; }, {passive:true});
    window.addEventListener('touchmove',(e)=>{ const t = e.touches[0]; if(t) updatePointer(t); }, {passive:true});
    window.addEventListener('touchend',(e)=>{ mouse.down = false; }, {passive:true});

  })();
  </script>
</body>
</html>
